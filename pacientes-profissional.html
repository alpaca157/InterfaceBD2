<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVITTA - Pacientes do Profissional</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>AVITTA</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="menu.html" class="nav-item">
                    <span class="nav-icon">üè†</span>
                    <span>Iniciar</span>
                </a>
                <a href="cadastro.html" class="nav-item">
                    <span class="nav-icon">üìù</span>
                    <span>Cadastrar</span>
                </a>
                <a href="consultas.html" class="nav-item">
                    <span class="nav-icon">üìã</span>
                    <span>Registros</span>
                </a>
                <a href="profissionais.html" class="nav-item active">
                    <span class="nav-icon">üë®‚Äç‚öïÔ∏è</span>
                    <span>Profissionais</span>
                </a>
                <a href="alertas.html" class="nav-item">
                    <span class="nav-icon">‚ö†Ô∏è</span>
                    <span>Alertas</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1>Pacientes do Profissional</h1>
                <button class="btn-voltar" onclick="voltar()">‚Üê Voltar</button>
            </header>

            <div class="content-wrapper">
                <div class="profissional-info">
                    <h2>Profissional ID: <span id="id-profissional-display"></span></h2>
                    <p>Total de pacientes: <strong id="total-pacientes">0</strong></p>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>Data In√≠cio</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-pacientes-profissional">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">Carregando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const idProfissional = sessionStorage.getItem('profissional_selecionado');
            
            if (!idProfissional) {
                alert('Nenhum profissional selecionado!');
                window.location.href = 'profissionais.html';
                return;
            }

            document.getElementById('id-profissional-display').textContent = idProfissional;
            carregarPacientesDoProfissional(idProfissional);
        });

        async function carregarPacientesDoProfissional(idProfissional) {
            const tbody = document.getElementById('tabela-pacientes-profissional');
            
            try {
                const response = await fetch(`${API_URL}/profissionais/${idProfissional}/pacientes`);
                const pacientes = await response.json();
                
                tbody.innerHTML = '';
                
                if (pacientes.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                                Nenhum paciente vinculado
                            </td>
                        </tr>
                    `;
                    document.getElementById('total-pacientes').textContent = '0';
                    return;
                }
                
                pacientes.forEach(paciente => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${paciente.ID_Paciente}</td>
                        <td>${paciente.Nome}</td>
                        <td>${formatarCPF(paciente.CPF)}</td>
                        <td>${formatarData(paciente.Data_Inicio)}</td>
                        <td><span class="status-ativo">ATIVO</span></td>
                        <td>
                            <button class="btn-action" onclick="verProntuario(${paciente.ID_Paciente})">üìÑ Prontu√°rio</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                document.getElementById('total-pacientes').textContent = pacientes.length;
            } catch (error) {
                console.error('Erro:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #dc3545;">
                            Erro ao carregar pacientes
                        </td>
                    </tr>
                `;
            }
        }
    </script>
</body>
</html>